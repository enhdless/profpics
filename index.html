<!doctype>
<html>

<head>
	<link rel="stylesheet" href="style.css">
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/camanjs/4.0.0/caman.full.min.js"></script>
	 <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
</head>

<body>

	<h1>2017 Homecoming Profile Pictures!</h1>
<div class="container">
	<div class="main">
		<div>
			<b>Upload a picture of yourself!</b>
			
			<input type="file" id="imageLoader" name="imageLoader" >
		<br><br>
			
		</div>

		<canvas id="img" width=600 height=600></canvas>
	</div>

	<div class="side">
		<h3>Notes</h3>
		<ul>
			<li>To try a different picture, refresh the page.</li>
			<li>Currently, the uploaded picture can't be moved or resized.</li>
		</ul>
		<!-- <h3>Move Image</h3>
		<input type="button" value="Move up" id="up" disabled>
		<input type="button" value="Move down" id="down" disabled>
		<br><br> -->
		<h3>Done?</h3>
		<a href="#" class="btn" id="btn-download">Download!</a>
	</div>


</div>


</body>

</html>

<script>
var imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', handleImage, false);
var canvas = document.getElementById('img');
var ctx = canvas.getContext('2d');

var frame = new Image();
frame.src = 'hc2014.png';
frame.onload = function(){
	ctx.drawImage(frame,0,0,600,600);
}

var img;
var imgX = 85;
var imgY = 163;
var w = 430;
function handleImage(e){
	$('#up, #down').removeAttr('disabled');
	canvas.width = 600;
    var reader = new FileReader();
    reader.onload = function(event){
        img = new Image();
        img.onload = function(){
            ctx.drawImage(img,85,163,w,img.height*w/img.width);
			ctx.drawImage(frame,0,0,600,600); 
		    Caman("#img", function () {
			  this.saturation(0).render();
			  this.sepia(50).render();
			});   
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]); 
}


/*$('#up').on('click',function() {
	canvas.width = 600;
	imgY -=10;
    ctx.drawImage(img,85,imgY,w,img.height*w/img.width);
	ctx.drawImage(frame,0,0,600,600);
});
$('#down').on('click',function() {
	canvas.width = 600;
	imgY +=10;
    ctx.drawImage(img,85,imgY,w,img.height*w/img.width);
		    Caman("#img", function () {
			  this.saturation(0).render();
			  this.sepia(50).render();
			});  
	ctx.drawImage(frame,0,0,600,600); 
});*/

var button = document.getElementById('btn-download');
button.addEventListener('click', function (e) {
    var dataURL = canvas.toDataURL('image/png');
    button.href = dataURL;
    button.download = "profile.png";
});

</script>